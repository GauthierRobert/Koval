<div class="history-container">
  <div class="section-header">
    <h3 class="section-title">Completed Sessions</h3>
    <button class="import-btn" (click)="triggerUpload()" [disabled]="importing">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
      {{ importing ? 'IMPORTING...' : 'IMPORT .FIT' }}
    </button>
    <input #fitInput type="file" accept=".fit" class="fit-input" (change)="onFileSelected($event)" />
  </div>

  <div class="import-error" *ngIf="importError">
    Could not parse FIT file. Make sure it contains a valid session.
  </div>



  <ng-container *ngIf="ftp$ | async as ftp">
    <div class="history-list" *ngIf="sessions$ | async as sessions">
      <div class="empty-state" *ngIf="sessions.length === 0">
        <p>No completed workouts yet</p>
        <p class="empty-hint">Upload a .FIT file from your device to get started</p>
      </div>

      <div *ngFor="let session of sessions" class="history-item"
        [class.selected]="(historyService.selectedSession$ | async)?.id === session.id"
        (click)="onSelect(session)">
        <div class="item-icon">
          <app-sport-icon [sport]="session.sportType" [size]="20"></app-sport-icon>
        </div>
        <div class="item-details">
          <span class="item-title">{{ session.title }}</span>
          <span class="item-meta">
            {{ formatTime(session.totalDuration) }} â€¢ {{ session.avgPower }}{{ getSportUnit(session) }} avg
            <span class="sync-icons">
              <span *ngIf="session.syncedToStrava" title="Synced to Strava">ðŸš´</span>
              <span *ngIf="session.syncedToGarmin" title="Synced to Garmin">âŒš</span>
            </span>
          </span>
          <div class="item-metrics">
            <span class="metric-badge tss">{{ getTss(session, ftp) }} TSS</span>
            <span class="metric-badge if">{{ getIF(session, ftp) | number:'1.2-2' }} IF</span>
          </div>
        </div>
        <div class="item-actions">
          <button class="dl-fit-btn" (click)="downloadFit($event, session)" title="Download FIT file">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </ng-container>
</div>
