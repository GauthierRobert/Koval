<div class="selection-layout">
  <app-sidebar></app-sidebar>

  <main class="selection-main">

    <!-- Sticky top bar: scheduled workouts -->
    <div class="schedule-bar">
      <!-- Overdue -->
      <div class="schedule-section overdue-section" *ngIf="(overdueWorkouts$ | async)?.length">
        <h2 class="section-title overdue-title">Overdue</h2>
        <div class="workout-cards">
          <div
            class="schedule-card overdue-card glass"
            *ngFor="let w of overdueWorkouts$ | async"
            (click)="openDetail(w)"
          >
            <div class="card-date">{{ formatScheduleDate(w.scheduledDate) }}</div>
            <div class="card-title">{{ w.trainingTitle || w.title || 'Workout' }}</div>
            <div class="card-duration">{{ formatScheduleDuration(w) }}</div>
          </div>
        </div>
      </div>

      <!-- This Week -->
      <div class="schedule-section">
        <h2 class="section-title">This Week</h2>
        <div class="workout-cards" *ngIf="(upcomingWorkouts$ | async)?.length">
          <div
            class="schedule-card glass"
            *ngFor="let w of upcomingWorkouts$ | async"
            (click)="openDetail(w)"
          >
            <div class="card-date">{{ formatScheduleDate(w.scheduledDate) }}</div>
            <div class="card-title">{{ w.trainingTitle || w.title || 'Workout' }}</div>
            <div class="card-duration">{{ formatScheduleDuration(w) }}</div>
          </div>
        </div>
        <div class="empty-week" *ngIf="!(upcomingWorkouts$ | async)?.length">
          No training scheduled for this week
        </div>
      </div>
    </div>

    <!-- Content area -->
    <div class="content-area">

      <!-- Session analysis (takes priority when a session is selected) -->
      <app-session-analysis
        *ngIf="selectedSession$ | async as session"
        [session]="session"
        (closed)="onSessionClosed()"
      ></app-session-analysis>

      <!-- Workout visualization -->
      <app-workout-visualization
        *ngIf="(selectedTraining$ | async) && !(selectedSession$ | async)"
        [training]="selectedTraining$ | async"
      ></app-workout-visualization>

      <!-- Hero fallback â€” only when nothing selected -->
      <div
        class="empty-state"
        *ngIf="!(selectedTraining$ | async) && !(selectedSession$ | async)"
      >
        <div class="hero-content glass">
          <h1>Hyper-Personalized AI Coaching</h1>
          <p>
            Select a workout from the history or start a new conversation with our Assistant to
            generate a training plan tailored to your profile.
          </p>
          <button class="cta-btn" routerLink="/chat">Chat with Assistant</button>
        </div>
      </div>
    </div>

  </main>
</div>

<app-workout-detail-modal
  [workout]="selectedScheduledWorkout"
  (closed)="onDetailClosed()"
  (started)="onDetailStarted()"
  (statusChanged)="onDetailStatusChanged()"
></app-workout-detail-modal>
