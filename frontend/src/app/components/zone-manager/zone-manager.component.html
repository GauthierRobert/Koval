<div class="zone-container" [class.embedded]="embedded">
  <!-- Header -->
  <div class="zone-header glass">
    <div class="header-left">
      <span class="highlight">ZONE</span> <span class="dim">SYSTEMS</span>
      <span class="zone-count">{{ zoneSystems.length }}</span>
    </div>
    <div class="header-right">
      <div class="sport-filters">
        <button *ngFor="let sport of sportTypes" class="sport-filter-btn"
          [class.active]="activeSportFilter === sport" (click)="setSportFilter(sport)">
          <app-sport-icon [sport]="sport" [size]="12"></app-sport-icon>
          {{ getSportLabel(sport) }}
        </button>
      </div>
      <div class="create-dropdown">
        <button class="create-btn" (click)="showCreateMenu = !showCreateMenu">+ NEW</button>
        <div class="create-menu" *ngIf="showCreateMenu">
          <button *ngFor="let sport of sportTypes" class="create-option" (click)="createNewSystem(sport)">
            <app-sport-icon [sport]="sport" [size]="14"></app-sport-icon>
            {{ getSportLabel(sport) }} Zones
          </button>
        </div>
      </div>
      <button *ngIf="embedded" class="close-btn" (click)="closed.emit()">&times;</button>
    </div>
  </div>

  <div class="zone-content">
    <!-- Systems list (left) -->
    <div class="systems-list glass">
      <div *ngFor="let system of filteredSystems" class="system-card"
        [class.selected]="selectedSystem?.id === system.id" (click)="selectSystem(system)">
        <div class="system-card-top">
          <app-sport-icon [sport]="system.sportType" [size]="14"></app-sport-icon>
          <span class="system-name">{{ system.name }}</span>
        </div>
        <div class="system-card-meta">
          <span class="meta-badge">{{ system.referenceType }}</span>
          <span class="meta-count">{{ system.zones.length }} zones</span>
        </div>
        <div class="zone-bar-preview">
          <div *ngFor="let zone of system.zones; let i = index" class="bar-segment"
            [style.flex]="zone.high - zone.low" [style.background]="getZoneColor(i)">
          </div>
        </div>
      </div>

      <div *ngIf="filteredSystems.length === 0" class="empty-systems">
        <p>No zone systems</p>
        <p class="hint">Click <strong>+ NEW</strong> to create one</p>
      </div>
    </div>

    <!-- Editor (right) -->
    <div class="editor glass" *ngIf="editingSystem; else noSelection">
      <!-- Editor header -->
      <div class="editor-header">
        <div class="editor-title">
          <input [(ngModel)]="editingSystem.name" class="name-input" placeholder="System Name" />
          <div class="editor-config">
            <div class="config-item">
              <label>SPORT</label>
              <select [(ngModel)]="editingSystem.sportType">
                <option *ngFor="let s of sportTypes" [value]="s">{{ getSportLabel(s) }}</option>
              </select>
            </div>
            <div class="config-item">
              <label>REFERENCE</label>
              <select [(ngModel)]="editingSystem.referenceType">
                <option *ngFor="let r of availableReferenceTypes" [value]="r.value">{{ r.label }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="editor-actions">
          <button class="save-btn" (click)="saveSystem()" [disabled]="saving">
            <span *ngIf="!saving && !saved">SAVE</span>
            <span *ngIf="saving">SAVING...</span>
            <span *ngIf="saved" class="saved-check">SAVED</span>
          </button>
          <button class="delete-btn" (click)="deleteSystem()" [disabled]="deleting">DELETE</button>
        </div>
      </div>

      <!-- Zone visualization bar -->
      <div class="zone-vis">
        <div class="zone-vis-bar">
          <div *ngFor="let zone of editingSystem.zones; let i = index" class="vis-segment"
            [style.flex]="zone.high - zone.low" [style.background]="getZoneColor(i)"
            [title]="zone.label + ': ' + zone.low + 'â€“' + zone.high + '%'">
            <span class="vis-label" *ngIf="(zone.high - zone.low) > 15">{{ zone.label }}</span>
          </div>
        </div>
      </div>

      <!-- Zones table -->
      <div class="zones-table">
        <div class="zones-table-header">
          <span class="col-color"></span>
          <span class="col-label">LABEL</span>
          <span class="col-range">RANGE (%)</span>
          <span class="col-desc">DESCRIPTION</span>
          <span class="col-actions"></span>
        </div>
        <div *ngFor="let zone of editingSystem.zones; let i = index; trackBy: trackByIndex" class="zone-row">
          <span class="col-color">
            <span class="color-dot" [style.background]="getZoneColor(i)"></span>
          </span>
          <span class="col-label">
            <input [(ngModel)]="zone.label" class="zone-input label-input" />
          </span>
          <span class="col-range">
            <input type="number" [(ngModel)]="zone.low" class="zone-input num-input" />
            <span class="range-dash">&ndash;</span>
            <input type="number" [(ngModel)]="zone.high" class="zone-input num-input" />
            <span class="range-pct">%</span>
          </span>
          <span class="col-desc">
            <input [(ngModel)]="zone.description" class="zone-input desc-input" placeholder="Description" />
          </span>
          <span class="col-actions">
            <button class="row-action danger" (click)="removeZone(i)" title="Remove zone">&times;</button>
          </span>
        </div>
        <button class="add-zone-row" (click)="addZone()">+ Add Zone</button>
      </div>
    </div>

    <ng-template #noSelection>
      <div class="empty-editor glass">
        <div class="empty-content">
          <div class="empty-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" />
              <line x1="3" y1="9" x2="21" y2="9" />
              <line x1="3" y1="15" x2="21" y2="15" />
              <line x1="9" y1="3" x2="9" y2="21" />
            </svg>
          </div>
          <h3>SELECT A ZONE SYSTEM</h3>
          <p>Choose from the list or create a new zone system to configure training intensity ranges.</p>
        </div>
      </div>
    </ng-template>
  </div>
</div>
