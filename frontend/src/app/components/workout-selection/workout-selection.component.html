<div class="selection-layout">
  <app-sidebar></app-sidebar>

  <main class="selection-main">

    <!-- Sticky top bar: scheduled workouts -->
    <div class="schedule-bar">
      <div class="schedule-strip">
        <!-- Overdue -->
        <div class="overdue-strip" *ngIf="(overdueWorkouts$ | async)?.length">
          <span class="strip-label overdue-label">OVERDUE</span>
          <div class="chips-container">
            <div class="workout-chip overdue" *ngFor="let w of overdueWorkouts$ | async" (click)="openDetail(w)">
              <app-sport-icon [sport]="w.sportType" [size]="12"></app-sport-icon>
              <span class="chip-date">{{ formatScheduleDate(w.scheduledDate) }}</span>
              <span class="chip-title">{{ w.trainingTitle || w.title || 'Workout' }}</span>
              <span class="chip-duration">{{ formatScheduleDuration(w) }}</span>
            </div>
          </div>
        </div>

        <!-- This Week -->
        <div class="weekly-strip">
          <span class="strip-label weekly-label">THIS WEEK</span>
          <ng-container *ngIf="(upcomingWorkouts$ | async) as upcoming">
            <div class="chips-container" *ngIf="upcoming.length > 0">
              <div class="workout-chip" *ngFor="let w of upcoming" (click)="openDetail(w)">
                <app-sport-icon [sport]="w.sportType" [size]="12"></app-sport-icon>
                <span class="chip-date">{{ formatScheduleDate(w.scheduledDate) }}</span>
                <span class="chip-title">{{ w.trainingTitle || w.title || 'Workout' }}</span>
                <span class="chip-duration">{{ formatScheduleDuration(w) }}</span>
              </div>
            </div>
            <div class="empty-week-small" *ngIf="!upcoming.length">
              <span class="dim">No workouts scheduled</span>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Content area -->
    <div class="content-area">

      <!-- Session analysis (takes priority when a session is selected) -->
      <app-session-analysis *ngIf="selectedSession$ | async as session" [session]="session"></app-session-analysis>

      <!-- Workout visualization -->
      <app-workout-visualization *ngIf="(selectedTraining$ | async) && !(selectedSession$ | async)"
        [training]="selectedTraining$ | async"></app-workout-visualization>

      <!-- Hero fallback â€” only when nothing selected -->
      <div class="empty-state" *ngIf="!(selectedTraining$ | async) && !(selectedSession$ | async)">
        <div class="hero-content glass">
          <h1>Hyper-Personalized AI Coaching</h1>
          <p>
            Select a workout from the history or start a new conversation with our Assistant to
            generate a training plan tailored to your profile.
          </p>
          <button class="cta-btn" routerLink="/chat">Chat with Assistant</button>
        </div>
      </div>
    </div>

  </main>
</div>

<app-workout-detail-modal [workout]="selectedScheduledWorkout" (closed)="onDetailClosed()" (started)="onDetailStarted()"
  (statusChanged)="onDetailStatusChanged()"></app-workout-detail-modal>